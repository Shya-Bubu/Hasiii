<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fish Blood & Circulation Mastery Quiz</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --primary-color: #4CAF50;
            --secondary-color: #2196F3;
            --error-color: #f44336;
            --success-color: #4CAF50;
            --border-color: #333;
            --option-bg: #2a2a2a;
            --option-hover: #3a3a3a;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            width: 90%;
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 2rem;
            font-weight: 500;
        }

        .quiz-container {
            display: none;
        }

        .question-container {
            margin-bottom: 2rem;
        }

        .difficulty-tag {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .basic {
            background-color: #4CAF50;
            color: white;
        }

        .intermediate {
            background-color: #FF9800;
            color: white;
        }

        .advanced {
            background-color: #f44336;
            color: white;
        }

        .question-text {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
            font-weight: 500;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .option {
            padding: 1rem;
            background-color: var(--option-bg);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid var(--border-color);
        }

        .option:hover {
            background-color: var(--option-hover);
        }

        .option.correct {
            background-color: var(--success-color);
            color: white;
        }

        .option.incorrect {
            background-color: var(--error-color);
            color: white;
        }

        .explanation {
            margin-top: 1rem;
            padding: 1rem;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            display: none;
            font-size: 0.95rem;
        }

        .correct-explanation {
            border-left: 4px solid var(--success-color);
        }

        .incorrect-explanation {
            border-left: 4px solid var(--error-color);
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }

        button {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #3e8e41;
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #0b7dda;
        }

        .start-screen, .result-screen {
            text-align: center;
            padding: 2rem;
        }

        .result-screen {
            display: none;
        }

        .score {
            font-size: 2rem;
            color: var(--primary-color);
            margin: 1rem 0;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: var(--border-color);
            border-radius: 5px;
            margin: 1rem 0;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="start-screen">
            <h1>Fish Blood & Circulation Mastery Quiz</h1>
            <p>Test your understanding of fish blood components, circulatory systems, and respiratory adaptations.</p>
            <button class="btn-primary" id="start-btn">Start Quiz</button>
        </div>

        <div class="quiz-container" id="quiz-container">
            <div class="progress-bar">
                <div class="progress" id="progress-bar"></div>
            </div>
            
            <div class="question-container">
                <div class="difficulty-tag" id="difficulty-tag"></div>
                <div class="question-text" id="question-text"></div>
                
                <div class="options-container" id="options-container"></div>
                
                <div class="explanation correct-explanation" id="correct-explanation"></div>
                <div class="explanation incorrect-explanation" id="incorrect-explanation"></div>
            </div>
            
            <div class="navigation">
                <button class="btn-secondary" id="prev-btn" disabled>Previous</button>
                <button class="btn-primary" id="next-btn">Next</button>
            </div>
        </div>

        <div class="result-screen" id="result-screen">
            <h1>Quiz Completed!</h1>
            <div class="score" id="final-score"></div>
            <p id="result-message"></p>
            <button class="btn-primary" id="restart-btn">Restart Quiz</button>
        </div>
    </div>

    <script>
        // Quiz questions data
        const questions = [
            // Basic Questions (1-10)
            {
                difficulty: "basic",
                question: "What percentage of body weight does blood typically comprise in bony fishes?",
                options: [
                    "1-2%",
                    "3-7%",
                    "8-12%",
                    "15-20%"
                ],
                correctAnswer: 1,
                explanation: {
                    correct: "Correct! Blood volume in bony fishes typically ranges from 3% to 7% of total body weight.",
                    incorrect: "The lecture specifies 3-7% for bony fishes, with higher percentages for elasmobranchs and agnatha."
                }
            },
            {
                difficulty: "basic",
                question: "Where are erythrocytes primarily produced in teleost fish?",
                options: [
                    "Bone marrow",
                    "Liver",
                    "Kidney and spleen",
                    "Gills"
                ],
                correctAnswer: 2,
                explanation: {
                    correct: "Correct! In teleosts, erythrocytes are produced in the kidney and spleen.",
                    incorrect: "Fish bone has no marrow for blood formation, and the other organs are not primary hematopoietic sites."
                }
            },
            {
                difficulty: "basic",
                question: "What is the primary function of thrombocytes in fish blood?",
                options: [
                    "Oxygen transport",
                    "Immune response",
                    "Blood clotting",
                    "Carbon dioxide removal"
                ],
                correctAnswer: 2,
                explanation: {
                    correct: "Correct! Thrombocytes are an important part of the clotting process in fish.",
                    incorrect: "While other cells perform these functions, thrombocytes specialize in clotting."
                }
            },
            {
                difficulty: "basic",
                question: "Which chamber of the fish heart contains the pacemaker cells?",
                options: [
                    "Atrium",
                    "Ventricle",
                    "Sinus venosus",
                    "Bulbus arteriosus"
                ],
                correctAnswer: 2,
                explanation: {
                    correct: "Correct! The sinus venosus contains the pacemaker cells that initiate heart contractions.",
                    incorrect: "While these other chambers have important functions, the pacemaker is in the sinus venosus."
                }
            },
            {
                difficulty: "basic",
                question: "What is the function of the bulbus arteriosus?",
                options: [
                    "Generate blood pressure",
                    "Dampen pressure pulses",
                    "Oxygenate blood",
                    "Filter blood"
                ],
                correctAnswer: 1,
                explanation: {
                    correct: "Correct! The bulbus arteriosus dampens pressure pulses to protect the delicate gill capillaries.",
                    incorrect: "These other functions are performed by different parts of the circulatory system."
                }
            },
            {
                difficulty: "basic",
                question: "Which fish is known to lack hemoglobin?",
                options: [
                    "Tuna",
                    "Antarctic crocodile icefish",
                    "Salmon",
                    "Goldfish"
                ],
                correctAnswer: 1,
                explanation: {
                    correct: "Correct! The Antarctic crocodile icefish lacks hemoglobin and survives due to low metabolic needs and high environmental oxygen.",
                    incorrect: "All other listed fish have hemoglobin as their respiratory pigment."
                }
            },
            {
                difficulty: "basic",
                question: "What is the normal range for leukocytes in fish blood?",
                options: [
                    "200-500 cells/mm³",
                    "2,000-5,000 cells/mm³",
                    "20,000-150,000 cells/mm³",
                    "2-4 million cells/mm³"
                ],
                correctAnswer: 2,
                explanation: {
                    correct: "Correct! Fish typically have 20,000-150,000 WBCs/mm³, much fewer than RBCs.",
                    incorrect: "The other ranges are either too low or represent RBC counts."
                }
            },
            {
                difficulty: "basic",
                question: "What is hematocrit a measure of?",
                options: [
                    "White blood cell count",
                    "Ratio of packed RBCs to total blood volume",
                    "Hemoglobin concentration",
                    "Blood clotting time"
                ],
                correctAnswer: 1,
                explanation: {
                    correct: "Correct! Hematocrit measures the ratio of packed RBCs to total blood volume.",
                    incorrect: "While related to some of these, hematocrit specifically measures packed cell volume."
                }
            },
            {
                difficulty: "basic",
                question: "Which organ produces monocytes in teleosts?",
                options: [
                    "Liver",
                    "Kidney",
                    "Spleen",
                    "Gills"
                ],
                correctAnswer: 1,
                explanation: {
                    correct: "Correct! Monocytes are thought to originate in the kidney in teleosts.",
                    incorrect: "While the spleen is involved in blood cell production, monocytes specifically come from the kidney."
                }
            },
            {
                difficulty: "basic",
                question: "What is the Bohr effect?",
                options: [
                    "Increased oxygen affinity at lower pH",
                    "Decreased oxygen affinity at higher pH",
                    "Hemoglobin's reduced capacity to bind oxygen",
                    "Temperature's effect on oxygen affinity"
                ],
                correctAnswer: 1,
                explanation: {
                    correct: "Correct! The Bohr effect describes hemoglobin's higher oxygen affinity at higher pH (lower CO₂).",
                    incorrect: "These describe other phenomena like the Root effect or temperature effects."
                }
            },

            // Intermediate Questions (11-20)
            {
                difficulty: "intermediate",
                question: "Why might erythrocyte concentration increase during spawning season?",
                options: [
                    "Increased metabolic demands",
                    "Water temperature changes",
                    "Gill damage from mating",
                    "Increased predation risk"
                ],
                correctAnswer: 0,
                explanation: {
                    correct: "Correct! Increased metabolic demands during spawning likely drive higher RBC production.",
                    incorrect: "While these may affect fish physiology, they don't directly explain seasonal RBC increases."
                }
            },
            {
                difficulty: "intermediate",
                question: "What does a high hematocrit reading typically indicate in fish?",
                options: [
                    "Anemia",
                    "Stress or dehydration",
                    "Gill damage",
                    "Osmoregulation impairment"
                ],
                correctAnswer: 1,
                explanation: {
                    correct: "Correct! High hematocrit suggests stress, dehydration, or increased hemoglobin concentrations.",
                    incorrect: "Low hematocrit would indicate these other conditions."
                }
            },
            {
                difficulty: "intermediate",
                question: "How does the fish circulatory system differ from mammals?",
                options: [
                    "Fish have two separate ventricles",
                    "Blood passes through two capillary beds sequentially",
                    "Fish have higher blood pressure in systemic circulation",
                    "Fish lack arteries"
                ],
                correctAnswer: 1,
                explanation: {
                    correct: "Correct! Fish blood passes through gill then systemic capillaries, causing substantial pressure drop.",
                    incorrect: "Fish have single ventricle, lower systemic pressure, and do have arteries."
                }
            },
            {
                difficulty: "intermediate",
                question: "What is the primary form in which CO₂ is transported in fish blood?",
                options: [
                    "Dissolved in plasma",
                    "Carbaminohemoglobin",
                    "Bicarbonate ions",
                    "Free carbonic acid"
                ],
                correctAnswer: 2,
                explanation: {
                    correct: "Correct! Most CO₂ is carried as bicarbonate ions, with smaller amounts as carbaminohemoglobin or dissolved.",
                    incorrect: "While these forms exist, bicarbonate accounts for the greatest proportion."
                }
            },
            {
                difficulty: "intermediate",
                question: "What unique adaptation do African lungfish have for air breathing?",
                options: [
                    "Accessory hearts",
                    "Outpocketing of the gut (primitive lung)",
                    "Modified gills",
                    "Cutaneous respiration"
                ],
                correctAnswer: 1,
                explanation: {
                    correct: "Correct! African lungfish have an outpocketing of the gut that functions as a primitive lung.",
                    incorrect: "While some fish have these adaptations, the gut modification is unique to lungfish."
                }
            },
            {
                difficulty: "intermediate",
                question: "What enzyme accelerates CO₂ conversion to carbonic acid in RBCs?",
                options: [
                    "Hemolysin",
                    "Carbonic anhydrase",
                    "Thrombin",
                    "Prothrombin"
                ],
                correctAnswer: 1,
                explanation: {
                    correct: "Correct! Carbonic anhydrase rapidly converts CO₂ to carbonic acid in red blood cells.",
                    incorrect: "These other enzymes have different functions in blood physiology."
                }
            },
            {
                difficulty: "intermediate",
                question: "Why are fish RBCs nucleated unlike mammalian RBCs?",
                options: [
                    "For DNA repair in aquatic environments",
                    "To enable cell division in bloodstream",
                    "Evolutionary retention of primitive characteristic",
                    "To store more hemoglobin"
                ],
                correctAnswer: 2,
                explanation: {
                    correct: "Correct! Nucleated RBCs represent an evolutionary primitive characteristic retained in fish.",
                    incorrect: "While interesting hypotheses, the primary reason is evolutionary retention."
                }
            },
            {
                difficulty: "intermediate",
                question: "What happens to chloride ions during CO₂ uptake in fish blood?",
                options: [
                    "They bind to hemoglobin",
                    "They diffuse into RBCs to balance bicarbonate loss",
                    "They are excreted at the gills",
                    "They form carbonic acid"
                ],
                correctAnswer: 1,
                explanation: {
                    correct: "Correct! Chloride ions enter RBCs to balance bicarbonate diffusion to plasma (chloride shift).",
                    incorrect: "Chlorides don't participate in these other ways during gas exchange."
                }
            },
            {
                difficulty: "intermediate",
                question: "Which granulocyte is most common in brown trout blood?",
                options: [
                    "Eosinophils",
                    "Basophils",
                    "Neutrophils",
                    "Lymphocytes"
                ],
                correctAnswer: 2,
                explanation: {
                    correct: "Correct! Neutrophils comprise up to 25% of WBCs in brown trout.",
                    incorrect: "These other cells are present but less abundant than neutrophils."
                }
            },
            {
                difficulty: "intermediate",
                question: "What structural feature allows hemoglobin's oxygen affinity to change with pH?",
                options: [
                    "Iron atoms in heme groups",
                    "Quaternary structure changes",
                    "Number of polypeptide chains",
                    "Presence of nuclei in fish RBCs"
                ],
                correctAnswer: 1,
                explanation: {
                    correct: "Correct! pH changes alter hemoglobin's quaternary structure, affecting oxygen access to heme groups.",
                    incorrect: "While these are features of hemoglobin, the quaternary structure change mediates pH effects."
                }
            },

            // Advanced Questions (21-30)
            {
                difficulty: "advanced",
                question: "Why might active fish species have smaller RBCs than less active species?",
                options: [
                    "Shorter diffusion distance for oxygen",
                    "Less need for hemoglobin",
                    "Reduced risk of clotting",
                    "Easier passage through gill capillaries"
                ],
                correctAnswer: 0,
                explanation: {
                    correct: "Correct! Smaller RBCs provide shorter diffusion distance and greater total surface area for gas exchange.",
                    incorrect: "Active species actually need more hemoglobin and these other factors aren't primary drivers."
                }
            },
            {
                difficulty: "advanced",
                question: "How does the Root effect differ from the Bohr effect?",
                options: [
                    "Root effect involves complete loss of oxygen binding",
                    "Bohr effect is temperature-dependent",
                    "Root effect increases oxygen affinity",
                    "Bohr effect occurs only in mammals"
                ],
                correctAnswer: 0,
                explanation: {
                    correct: "Correct! The Root effect describes structural changes that prevent oxygen binding, unlike Bohr's affinity modulation.",
                    incorrect: "Both effects occur in fish and relate to pH, not temperature or taxonomy."
                }
            },
            {
                difficulty: "advanced",
                question: "Why do fish circulatory systems limit aerobic metabolism compared to mammals?",
                options: [
                    "Two-capillary bed design reduces systemic pressure",
                    "Lower hemoglobin concentrations",
                    "Smaller heart size relative to body",
                    "Lack of coronary circulation"
                ],
                correctAnswer: 0,
                explanation: {
                    correct: "Correct! Sequential capillary beds cause substantial pressure drop, slowing oxygen delivery.",
                    incorrect: "While these may be factors, the two-capillary design is the primary constraint."
                }
            },
            {
                difficulty: "advanced",
                question: "What evolutionary advantage does the Leydig organ provide elasmobranchs?",
                options: [
                    "Extra oxygen storage",
                    "Additional hematopoietic tissue",
                    "Enhanced immune function",
                    "Buoyancy control"
                ],
                correctAnswer: 1,
                explanation: {
                    correct: "Correct! The Leydig organ provides additional blood cell production capacity beyond the spleen.",
                    incorrect: "While blood relates to these functions, the Leydig organ specifically produces blood cells."
                }
            },
            {
                difficulty: "advanced",
                question: "Why might basophils be absent in some fish species?",
                options: [
                    "Reduced need for histamine responses",
                    "Compensation by other granulocytes",
                    "Evolutionary loss of unnecessary cell type",
                    "All of the above"
                ],
                correctAnswer: 3,
                explanation: {
                    correct: "Correct! Multiple factors likely contribute to basophil presence/absence across species.",
                    incorrect: "While each may be true, the complete answer includes all possibilities."
                }
            },
            {
                difficulty: "advanced",
                question: "How does the African lungfish heart adapt for air breathing?",
                options: [
                    "Complete ventricular separation",
                    "Partial atrial and ventricular separation",
                    "Additional ventricle",
                    "Loss of bulbus arteriosus"
                ],
                correctAnswer: 1,
                explanation: {
                    correct: "Correct! Lungfish have partially divided atria and ventricle to separate oxygenated/deoxygenated blood.",
                    incorrect: "The separation is partial, not complete, and other structures remain."
                }
            },
            {
                difficulty: "advanced",
                question: "Why is chlorine particularly harmful to fish RBCs?",
                options: [
                    "Disrupts hemoglobin's iron atoms",
                    "Inhibits metabolic pathways",
                    "Causes cell lysis",
                    "Prevents nucleus function"
                ],
                correctAnswer: 1,
                explanation: {
                    correct: "Correct! Chlorine destroys RBCs by inhibiting vital metabolic pathways within the cells.",
                    incorrect: "Chlorine's primary damage comes from metabolic disruption, not these other effects."
                }
            },
            {
                difficulty: "advanced",
                question: "What advantage do nucleated RBCs provide for fish?",
                options: [
                    "Longer cell lifespan",
                    "On-demand hemoglobin production",
                    "Better repair of oxidative damage",
                    "All of the above"
                ],
                correctAnswer: 3,
                explanation: {
                    correct: "Correct! Nucleated RBCs can potentially provide all these advantages over mammalian RBCs.",
                    incorrect: "While each is true, the complete answer includes all these benefits."
                }
            },
            {
                difficulty: "advanced",
                question: "Why do fish not need bone marrow for hematopoiesis?",
                options: [
                    "Lower blood cell turnover",
                    "Multiple alternative hematopoietic organs",
                    "Water supports cell production",
                    "Both A and B"
                ],
                correctAnswer: 3,
                explanation: {
                    correct: "Correct! Fish have kidney, spleen, and other organs for blood cell production, and may have lower turnover.",
                    incorrect: "While water environment is important, it doesn't directly replace marrow function."
                }
            },
            {
                difficulty: "advanced",
                question: "How does the fish circulatory system compensate for pressure loss at gills?",
                options: [
                    "Higher ventricular pressure",
                    "Body movement aiding circulation",
                    "Accessory hearts in some species",
                    "All of the above"
                ],
                correctAnswer: 3,
                explanation: {
                    correct: "Correct! Fish employ multiple strategies to maintain circulation despite gill pressure drop.",
                    incorrect: "While each helps, the complete answer includes all these adaptations."
                }
            }
        ];

        // Randomize the correct answers with distribution control
        function shuffleQuestions() {
            let lastCorrectPositions = [];
            
            questions.forEach(q => {
                const correctOption = q.options[q.correctAnswer];
                
                // Keep shuffling until we meet the distribution requirements
                let isValidShuffle = false;
                while (!isValidShuffle) {
                    // Fisher-Yates shuffle
                    for (let i = q.options.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [q.options[i], q.options[j]] = [q.options[j], q.options[i]];
                    }
                    
                    // Update correct answer index
                    const newPosition = q.options.indexOf(correctOption);
                    
                    // Check if this position has been used too much recently
                    const recentOccurrences = lastCorrectPositions.filter(pos => pos === newPosition).length;
                    if (recentOccurrences < 3) {
                        q.correctAnswer = newPosition;
                        lastCorrectPositions.push(newPosition);
                        if (lastCorrectPositions.length > 5) {
                            lastCorrectPositions.shift();
                        }
                        isValidShuffle = true;
                    }
                }
            });
        }

        shuffleQuestions();

        // Quiz state variables
        let currentQuestionIndex = 0;
        let score = 0;
        let userAnswers = Array(questions.length).fill(null);
        let quizStarted = false;

        // DOM elements
        const startScreen = document.querySelector('.start-screen');
        const quizContainer = document.getElementById('quiz-container');
        const resultScreen = document.getElementById('result-screen');
        const startBtn = document.getElementById('start-btn');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const restartBtn = document.getElementById('restart-btn');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const difficultyTag = document.getElementById('difficulty-tag');
        const correctExplanation = document.getElementById('correct-explanation');
        const incorrectExplanation = document.getElementById('incorrect-explanation');
        const progressBar = document.getElementById('progress-bar');
        const finalScore = document.getElementById('final-score');
        const resultMessage = document.getElementById('result-message');

        // Initialize the quiz
        function initQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            userAnswers = Array(questions.length).fill(null);
            loadQuestion();
            updateProgressBar();
            updateNavigationButtons();
            quizContainer.style.display = 'block';
            resultScreen.style.display = 'none';
        }

        // Load the current question
        function loadQuestion() {
            const question = questions[currentQuestionIndex];
            
            // Set question text and difficulty
            questionText.textContent = question.question;
            difficultyTag.textContent = question.difficulty;
            difficultyTag.className = 'difficulty-tag ' + question.difficulty;
            
            // Clear previous options and explanations
            optionsContainer.innerHTML = '';
            correctExplanation.style.display = 'none';
            incorrectExplanation.style.display = 'none';
            
            // Create options
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.classList.add('option');
                optionElement.textContent = option;
                optionElement.dataset.index = index;
                
                // Highlight if already answered
                if (userAnswers[currentQuestionIndex] !== null) {
                    if (index === question.correctAnswer) {
                        optionElement.classList.add('correct');
                    } else if (index === userAnswers[currentQuestionIndex] && index !== question.correctAnswer) {
                        optionElement.classList.add('incorrect');
                    }
                }
                
                optionElement.addEventListener('click', () => selectOption(index));
                optionsContainer.appendChild(optionElement);
            });
            
            // Show explanations if already answered
            if (userAnswers[currentQuestionIndex] !== null) {
                showExplanations();
            }
        }

        // Handle option selection
        function selectOption(optionIndex) {
            // Only allow selection if not already answered
            if (userAnswers[currentQuestionIndex] !== null) return;
            
            const question = questions[currentQuestionIndex];
            userAnswers[currentQuestionIndex] = optionIndex;
            
            // Update score if correct
            if (optionIndex === question.correctAnswer) {
                score++;
            }
            
            // Highlight selected option
            const options = document.querySelectorAll('.option');
            options.forEach((option, index) => {
                if (index === optionIndex) {
                    option.classList.add(index === question.correctAnswer ? 'correct' : 'incorrect');
                }
                if (index === question.correctAnswer && index !== optionIndex) {
                    option.classList.add('correct');
                }
            });
            
            // Show explanations
            showExplanations();
            updateProgressBar();
            updateNavigationButtons();
        }

        // Show explanations for the current question
        function showExplanations() {
            const question = questions[currentQuestionIndex];
            const userAnswer = userAnswers[currentQuestionIndex];
            
            correctExplanation.textContent = question.explanation.correct;
            correctExplanation.style.display = 'block';
            
            if (userAnswer !== question.correctAnswer) {
                incorrectExplanation.textContent = question.explanation.incorrect;
                incorrectExplanation.style.display = 'block';
            }
        }

        // Update navigation buttons state
        function updateNavigationButtons() {
            prevBtn.disabled = currentQuestionIndex === 0;
            
            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.textContent = 'Finish';
            } else {
                nextBtn.textContent = 'Next';
            }
        }

        // Update progress bar
        function updateProgressBar() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        // Show quiz results
        function showResults() {
            const percentage = Math.round((score / questions.length) * 100);
            finalScore.textContent = `${score}/${questions.length} (${percentage}%)`;
            
            if (percentage >= 80) {
                resultMessage.textContent = 'Circulation Expert! You have mastered fish blood and circulatory systems.';
            } else if (percentage >= 60) {
                resultMessage.textContent = 'Strong performance! You understand most concepts but could review some areas.';
            } else if (percentage >= 40) {
                resultMessage.textContent = 'Good effort! Focus on the explanations to improve your knowledge.';
            } else {
                resultMessage.textContent = 'Keep studying! Review the lecture materials and try again.';
            }
            
            quizContainer.style.display = 'none';
            resultScreen.style.display = 'block';
        }

        // Event listeners
        startBtn.addEventListener('click', () => {
            startScreen.style.display = 'none';
            quizStarted = true;
            initQuiz();
        });

        prevBtn.addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
                updateNavigationButtons();
                updateProgressBar();
            }
        });

        nextBtn.addEventListener('click', () => {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
                updateNavigationButtons();
                updateProgressBar();
            } else {
                showResults();
            }
        });

        restartBtn.addEventListener('click', () => {
            initQuiz();
        });

        // Initialize
        if (!quizStarted) {
            startScreen.style.display = 'block';
            quizContainer.style.display = 'none';
            resultScreen.style.display = 'none';
        }
    </script>
</body>
</html>